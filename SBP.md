# Симулятор Sub-Bottom Profiler с оптимизацией параметров

---

## 1. ОБЩИЕ ПОЛОЖЕНИЯ

### 1.1. Назначение

Разрабатываемый программный комплекс предназначен для:
- Моделирования гидроакустического зондирования донных и поддонных слоёв
- Получения профиля грунта (sub-bottom profile) — послойной структуры донных отложений
- Расчёта глубины проникновения сигнала в грунт
- Оценки вертикального разрешения профиля (минимальной толщины различимого слоя)
- Оптимизации параметров Sub-Bottom Profiler (SBP)
- Подбора компонентной базы (LNA, VGA, ADC, трансдьюсер)

### 1.2. Область применения

Программный комплекс используется для:
- Инженерных расчётов параметров гидроакустических систем
- Проектирования приёмного тракта с учётом реальных микросхем
- Оценки работоспособности системы до изготовления прототипа
- Оптимизации энергопотребления и стоимости компонентов

---

## 2. ФИЗИЧЕСКИЕ И МАТЕМАТИЧЕСКИЕ ОСНОВАНИЯ

### 2.1. Гидроакустическое уравнение для профиля грунта

Основное уравнение гидроакустики для расчёта уровня сигнала на заданной глубине в профиле:

$$
SNR(z) = SL - TL_{water}(z) - TL_{sediment}(z) + R - NL + PG
$$

где:
- $SNR(z)$ — отношение сигнал/шум на глубине $z$ в профиле, дБ
- $SL$ — уровень источника (Source Level), дБ re 1 µPa @ 1 м
- $TL_{water}(z)$ — потери передачи в воде до глубины $z$, дБ
- $TL_{sediment}(z)$ — потери передачи в грунте на глубине $z$, дБ
- $R$ — коэффициент отражения от границы раздела, дБ
- $NL$ — уровень шумов, дБ
- $PG$ — выигрыш обработки (Processing Gain), дБ

### 2.2. Модель сигнала (CHIRP)

#### 2.2.1. Временная форма

Передаваемый сигнал описывается функцией:

$$
s_{tx}(t) = A \cdot w(t) \cdot \cos\left(2\pi\left(f_0 t + \frac{B}{2T}t^2\right)\right), \quad 0 \leq t \leq T
$$

где:
- $A$ — амплитуда сигнала
- $w(t)$ — оконная функция (Rect, Hann, Tukey)
- $f_0$ — начальная частота, Гц
- $f_1$ — конечная частота, Гц
- $B = f_1 - f_0$ — полоса частот, Гц
- $T$ — длительность импульса, с

#### 2.2.2. Мгновенная частота CHIRP

Мгновенная частота линейного CHIRP-сигнала:

$$
f_i(t) = f_0 + \frac{B}{T} \cdot t, \quad 0 \leq t \leq T
$$

где:
- $f_0$ — начальная частота, Гц
- $B = f_1 - f_0$ — полоса частот, Гц
- $T$ — длительность импульса, с
- $t$ — время, с

#### 2.2.3. Спектр сигнала

Спектр CHIRP-сигнала приближённо описывается прямоугольной функцией:

$$
S(f) \approx \text{rect}\left(\frac{f - f_c}{B}\right)
$$

где:
- $f_c = \frac{f_0 + f_1}{2}$ — центральная частота, Гц
- $B = f_1 - f_0$ — полоса частот, Гц

Функция $\text{rect}(x)$ равна 1 при $|x| \leq 0.5$ и 0 в противном случае.

#### 2.2.4. Выигрыш обработки (Processing Gain)

Для согласованной фильтрации выигрыш обработки рассчитывается как:

$$
PG = 10 \cdot \log_{10}(B \cdot T)
$$

где:
- $B = f_1 - f_0$ — полоса частот, Гц
- $T$ — длительность импульса, с
- $B \cdot T$ — произведение полосы на длительность (time-bandwidth product), безразмерное

**Пример:** при $B = 100$ кГц и $T = 1$ мс:
$$
PG = 10 \cdot \log_{10}(100 \times 10^3 \times 1 \times 10^{-3}) = 10 \cdot \log_{10}(100) = 20 \text{ дБ}
$$

### 2.3. Модель распространения в воде

#### 2.3.1. Давление на глубине

Давление рассчитывается по формуле:

$$
P(z) = 1.0 + 0.1 \cdot z
$$

где:
- $P$ — давление, дБар (dBar)
- $z$ — глубина, м

Примечание: 1 дБар ≈ 1 м глубины.

#### 2.3.2. Скорость звука

Скорость звука в воде по формуле Mackenzie (1981):

$$
\begin{align}
c(T, S, P) &= 1448.96 + 4.591 \cdot T - 5.304 \times 10^{-2} \cdot T^2 + 2.374 \times 10^{-4} \cdot T^3 \\
&\quad + 1.340 \cdot (S - 35) + 1.630 \times 10^{-2} \cdot P + 1.675 \times 10^{-7} \cdot P^2 \\
&\quad - 1.025 \times 10^{-2} \cdot T \cdot (S - 35) - 7.139 \times 10^{-13} \cdot T \cdot P^3
\end{align}
$$

где:
- $c$ — скорость звука, м/с
- $T$ — температура, °C (диапазон: 0–30 °C)
- $S$ — солёность, PSU (диапазон: 0–35 PSU)
- $P$ — давление, дБар (dBar), рассчитывается по формуле $P(z) = 1.0 + 0.1 \cdot z$

Типичные значения: $c \approx 1450$–$1550$ м/с для морской воды.

#### 2.3.3. Коэффициент поглощения

Коэффициент поглощения в воде рассчитывается по формуле Francois–Garrison (1982):

$$
\alpha_w(f, T, S, P) = \frac{A_1 \cdot P_1 \cdot f_1 \cdot f_k^2}{f_1^2 + f_k^2} + \frac{A_2 \cdot P_2 \cdot f_2 \cdot f_k^2}{f_2^2 + f_k^2} + \frac{A_3 \cdot P_3 \cdot f_3 \cdot f_k^2}{f_3^2 + f_k^2}
$$

где $f_k = f / 1000$ — частота в кГц, $f$ — частота в Гц.

**Вязкое поглощение** (первое слагаемое):
$$
\begin{align}
A_1 &= 1.03 \times 10^{-8} + 2.36 \times 10^{-10} \cdot T - 5.22 \times 10^{-12} \cdot T^2 \\
f_1 &= 1.32 \times 10^3 \cdot (T + 273.1) \cdot \exp\left(-\frac{1700}{T + 273.1}\right) \\
P_1 &= 1.0
\end{align}
$$

**Релаксационное поглощение бората** (второе слагаемое):
$$
\begin{align}
A_2 &= 5.62 \times 10^{-8} \cdot \left(1.0 + 0.00654 \cdot (S - 35)\right) \\
f_2 &= 1.55 \times 10^7 \cdot (T + 273.1) \cdot \exp\left(-\frac{3052}{T + 273.1}\right) \\
P_2 &= 1.0 - 1.23 \times 10^{-4} \cdot P
\end{align}
$$

**Релаксационное поглощение сульфата магния** (третье слагаемое):
$$
\begin{align}
A_3 &= 3.38 \times 10^{-6} \cdot \exp\left(-\frac{2000}{T + 273.1}\right) \cdot \left(1.0 + 0.00654 \cdot (S - 35)\right) \\
f_3 &= \frac{1.55 \times 10^7 \cdot (T + 273.1) \cdot \exp\left(-\frac{3052}{T + 273.1}\right)}{1.0 + 0.00654 \cdot (S - 35)} \\
P_3 &= 1.0 - 3.83 \times 10^{-5} \cdot P + 4.9 \times 10^{-10} \cdot P^2
\end{align}
$$

Результат в неперах на метр (Np/m), переводится в дБ/м:

$$
\alpha_{w,dB}(f, T, S, P) = \alpha_w(f, T, S, P) \cdot 8.686
$$

где коэффициент 8.686 = 20/ln(10) — преобразование из неперов в децибелы.

**Параметры:**
- $f$ — частота, Гц
- $T$ — температура, °C
- $S$ — солёность, PSU
- $P$ — давление, дБар

**Типичные значения:** $\alpha_{w,dB} \approx 0.01$–$1.0$ дБ/м для частот 10–500 кГц.

#### 2.3.4. Потери распространения (Spreading Loss)

Потери из-за сферического расхождения (geometric spreading):

$$
TL_{spread}(r) = 20 \cdot \log_{10}(r)
$$

где $r$ — расстояние, м.

#### 2.3.5. Полные потери передачи в воде

Общие потери передачи в воде (Transmission Loss) включают расхождение и поглощение:

$$
TL_{water}(r, f, T, S, P) = TL_{spread}(r) + TL_{abs}(r, f, T, S, P)
$$

или:

$$
TL_{water}(r, f, T, S, P) = 20 \cdot \log_{10}(r) + \alpha_{w,dB}(f, T, S, P) \cdot r
$$

где:
- $r$ — расстояние распространения, м
- $TL_{spread}(r)$ — потери из-за сферического расхождения, дБ
- $TL_{abs}(r, f, T, S, P) = \alpha_{w,dB}(f, T, S, P) \cdot r$ — потери из-за поглощения, дБ
- $\alpha_{w,dB}(f, T, S, P)$ — коэффициент поглощения, дБ/м

**Для round-trip** (туда и обратно):
$$
TL_{water,round}(D, f, T, S, P) = TL_{water}(2D, f, T, S, P) = 20 \cdot \log_{10}(2D) + \alpha_{w,dB}(f, T, S, P) \cdot 2D
$$

### 2.4. Модель грунта и профилирование поддонных слоёв

**Основная цель SBP: получение профиля грунта (sub-bottom profile) — послойной структуры донных отложений.**

#### 2.4.1. Многослойная модель грунта

Грунт представляется как последовательность горизонтальных слоёв:

$$
\text{Слой 1 (вода)} \rightarrow \text{Интерфейс 1} \rightarrow \text{Слой 2} \rightarrow \text{Интерфейс 2} \rightarrow \text{Слой 3} \rightarrow \ldots
$$

Каждый слой грунта характеризуется акустическим импедансом:

$$
Z_i = \rho_i \cdot c_i
$$

где:
- $\rho_i$ — плотность слоя, кг/м³
- $c_i$ — скорость звука в слое, м/с
- $Z_i$ — акустический импеданс, Па·с/м (кг/(м²·с))

#### 2.4.2. Типы грунтов и типичные параметры

| Тип грунта | Плотность $\rho$, кг/м³ | Скорость $c$, м/с | Импеданс $Z$, кг/(м²·с) | Затухание $\alpha$, дБ/м |
|------------|------------------------|-------------------|------------------------|-------------------------|
| Глина (Clay) | 1400–1800 | 1500–1600 | 2.1–2.9×10⁶ | 0.5–2.0 |
| Ил (Silt) | 1600–1900 | 1500–1650 | 2.4–3.1×10⁶ | 1.0–3.0 |
| Песок (Sand) | 1800–2100 | 1600–1800 | 2.9–3.8×10⁶ | 2.0–5.0 |
| Гравий (Gravel) | 1900–2200 | 1800–2000 | 3.4–4.4×10⁶ | 3.0–8.0 |
| Скала (Rock) | 2200–2800 | 2000–6000 | 4.4–16.8×10⁶ | 5.0–20.0 |

#### 2.4.3. Коэффициент отражения

На границе слоёв (интерфейсе):

$$
R_i = \frac{Z_{i+1} - Z_i}{Z_{i+1} + Z_i}
$$

где $R_i$ — коэффициент отражения (безразмерный, от -1 до +1).

В децибелах:

$$
R_i^{dB} = 20\log_{10}(|R_i|)
$$

Типичные значения:
- Глина/Ил: -10 до -20 дБ
- Песок: -6 до -12 дБ
- Гравий: -3 до -8 дБ
- Скала/Бетон: -1 до -3 дБ

Коэффициент прохождения:

$$
T_i = 1 + R_i = \frac{2Z_{i+1}}{Z_{i+1} + Z_i}
$$

#### 2.4.4. Затухание в грунте

Экспоненциальное затухание амплитуды:

$$
A(z) = A_0 \cdot e^{-\alpha z}
$$

или в децибелах (для двухстороннего прохождения):

$$
TL_{sediment}(z) = 2\alpha z
$$

где:
- $\alpha$ — коэффициент затухания, дБ/м (или Нп/м)
- $z$ — глубина проникновения в слой, м
- Множитель 2 учитывает путь туда и обратно (round trip)

Зависимость затухания от частоты:

$$
\alpha(f) = \alpha_0 \cdot f^n
$$

где $n \approx 1$–$1.5$ для большинства грунтов.

#### 2.4.5. Многократные отражения

Для кратных отражений (multiple reflections):

$$
s_{rx}^{(k)}(t) = R_k \cdot s_{tx}\left(t - \frac{2kz}{c}\right)
$$

где $k$ — порядок отражения (1, 2, 3, ...).

Амплитуда $k$-го отражения:

$$
A_k = A_0 \cdot R^k \cdot e^{-2k\alpha z}
$$

#### 2.4.6. Профиль грунта (Sub-Bottom Profile)

Профиль грунта — это график амплитуды отражённого сигнала в зависимости от времени (или глубины).

Формирование профиля:
1. **Генерация CHIRP-сигнала** — передача зондирующего импульса
2. **Распространение в воде** — до дна
3. **Отражения от интерфейсов** — последовательные отражения от границ слоёв
4. **Обработка принятого сигнала** — согласованная фильтрация, TVG
5. **Построение профиля** — визуализация амплитуды vs. глубина

Временная ось профиля связана с глубиной:

$$
z(t) = \frac{c \cdot t}{2}
$$

где $t$ — время задержки (TOF), $c$ — скорость звука в грунте.

#### 2.4.7. Разрешение профиля

Вертикальное разрешение (толщина минимально различимого слоя):

$$
\Delta z = \frac{c}{2B}
$$

где $B$ — полоса частот CHIRP-сигнала.

Пример: при $B = 100$ кГц и $c = 1500$ м/с:
$$
\Delta z = \frac{1500}{2 \times 100000} = 0.0075 \text{ м} = 7.5 \text{ мм}
$$

Глубина проникновения:

$$
z_{max} = \frac{SL - TL_{water} + R - NL + PG - SNR_{min}}{2\alpha}
$$

#### 2.4.8. Интерпретация профиля

Основные признаки в профиле:
- **Сильное отражение** — резкая граница раздела (например, вода–песок)
- **Слабое отражение** — плавный переход (например, ил–глина)
- **Многократные отражения** — регулярные повторяющиеся эхо
- **Пропадание слоя** — слой не виден из-за недостаточного SNR
- **Артефакты** — боковые лепестки, интерференция

#### 2.4.9. Моделирование профиля в симуляторе

Симулятор должен:
1. Принимать описание многослойной структуры (количество слоёв, параметры каждого)
2. Рассчитывать временные задержки для каждого интерфейса
3. Применять затухание для каждого слоя
4. Суммировать все отражения с учётом задержек
5. Формировать итоговый профиль

Временная модель:

$$
s_{rx}(t) = \sum_{i=1}^{N} R_i \cdot s_{tx}\left(t - \frac{2\sum_{j=1}^{i} z_j}{c_i}\right) \cdot \prod_{j=1}^{i} e^{-\alpha_j z_j}
$$

где:
- $N$ — количество интерфейсов
- $z_j$ — толщина $j$-го слоя
- $c_i$ — скорость звука в слое до $i$-го интерфейса

### 2.5. Формирование принимаемого сигнала

#### 2.5.1. Временная модель отражений

Принимаемый сигнал формируется как сумма отражений от всех интерфейсов:

$$
s_{rx}(t) = \sum_{i=1}^{N} R_i \cdot s_{tx}\left(t - \tau_i\right) \cdot A_i
$$

где:
- $N$ — количество интерфейсов (отражений)
- $R_i$ — коэффициент отражения от $i$-го интерфейса (безразмерный)
- $s_{tx}(t)$ — передаваемый сигнал
- $\tau_i = \frac{2z_i}{c_i}$ — время задержки до $i$-го интерфейса, с
- $z_i$ — глубина $i$-го интерфейса, м
- $c_i$ — скорость звука в слое до $i$-го интерфейса, м/с
- $A_i = e^{-2\alpha_i z_i}$ — затухание амплитуды для round-trip
- $\alpha_i$ — коэффициент затухания в слое, Нп/м

**В децибелах:**

$$
A_i^{dB} = -2\alpha_i^{dB} \cdot z_i
$$

где $\alpha_i^{dB}$ — коэффициент затухания в дБ/м.

**Полная формула с учётом всех слоёв:**

$$
s_{rx}(t) = \sum_{i=1}^{N} R_i \cdot s_{tx}\left(t - \frac{2\sum_{j=1}^{i} z_j}{c_i}\right) \cdot \exp\left(-2\sum_{j=1}^{i-1} \alpha_j z_j\right)
$$

#### 2.5.2. Динамический диапазон

Отношение амплитуд донного и глубокого отражений:

$$
\frac{A_{bottom}}{A_{deep}} \approx e^{2\alpha \Delta z} \cdot \frac{R_{bottom}}{R_{deep}}
$$

Типично: 40–80 дБ динамического диапазона.

### 2.6. Модель шумов

#### 2.6.1. Аддитивный шум

$$
s_{noise}(t) \sim \mathcal{N}(0, \sigma^2)
$$

#### 2.6.2. Тепловой шум

Мощность теплового шума (мощность Джонсона–Найквиста):

$$
N_{thermal} = k_B \cdot T \cdot B \cdot F
$$

где:
- $k_B = 1.38 \times 10^{-23}$ Дж/К — постоянная Больцмана
- $T$ — температура, К (обычно 290 К = 17 °C)
- $B$ — полоса частот, Гц
- $F$ — шумовая фигура (безразмерная, $F \geq 1$)

В децибелах:

$$
N_{thermal,dB} = 10 \cdot \log_{10}(k_B \cdot T \cdot B) + NF_{dB}
$$

где $NF_{dB} = 10 \cdot \log_{10}(F)$ — шумовая фигура в дБ.

**Шум LNA:**

$$
N_{LNA} = k_B \cdot T \cdot B \cdot (10^{NF_{LNA}/10} - 1)
$$

где $NF_{LNA}$ — шумовая фигура LNA, дБ.

**Типичные значения:**
- Тепловой шум на $T = 290$ К, $B = 1$ МГц: $N_{thermal} \approx -114$ дБм
- Шумовая фигура хорошего LNA: $NF_{LNA} = 0.5$–$2.0$ дБ

### 2.7. Обработка сигнала

#### 2.7.1. Согласованная фильтрация

$$
y(t) = x_f(t) * s_{tx}^*(-t)
$$

где $*$ — операция свёртки, $s_{tx}^*$ — комплексно-сопряжённый сигнал.

#### 2.7.2. Огибающая

$$
e(t) = |x(t) + j \cdot \mathcal{H}\{x(t)\}|
$$

где $\mathcal{H}\{\cdot\}$ — преобразование Гильберта.

#### 2.7.3. Компенсация потерь (TVG)

Функция временной регулировки усиления в децибелах:

$$
G_{TVG}(t) = G_0 + 20 \cdot \log_{10}(t) + 2\alpha \cdot z(t)
$$

где:
- $G_0$ — начальное усиление, дБ
- $t$ — время после начала приёма, с
- $\alpha$ — коэффициент затухания в грунте, дБ/м
- $z(t) = \frac{c \cdot t}{2}$ — глубина, соответствующая времени $t$, м
- $c$ — скорость звука в грунте, м/с

**В линейном виде** (для применения к сигналу):

$$
G_{TVG,linear}(t) = 10^{G_{TVG}(t)/20} = k \cdot t^n \cdot e^{\beta t}
$$

где:
- $k = 10^{G_0/20}$ — коэффициент усиления
- $n \approx 1.5$–$2$ — показатель степени для сферического расхождения
- $\beta = \alpha \cdot c$ — коэффициент экспоненты для затухания в грунте

**Применение TVG к сигналу:**

$$
s_{TVG}(t) = s_{rx}(t) \cdot G_{TVG,linear}(t) = s_{rx}(t) \cdot 10^{G_{TVG}(t)/20}
$$

### 2.8. Оценка глубины проникновения

#### 2.8.1. Максимальная глубина

Из акустического уравнения дальности:

$$
z_{max} = \frac{SL - TL_{water} + R - NL + PG - SNR_{min}}{2\alpha}
$$

#### 2.8.2. Вертикальное разрешение

$$
\Delta z = \frac{c}{2B}
$$

где $B$ — полоса частот CHIRP-сигнала.

#### 2.8.3. Точность определения глубины в профиле

Стандартное отклонение оценки глубины интерфейса в профиле грунта (Cramér–Rao bound):

$$
\sigma_z = \frac{c}{2 \cdot B \cdot \sqrt{SNR}}
$$

где:
- $\sigma_z$ — стандартное отклонение глубины интерфейса, м
- $c$ — скорость звука в среде, м/с
- $B$ — полоса частот CHIRP-сигнала, Гц
- $SNR$ — отношение сигнал/шум (линейное, безразмерное)

В децибелах:

$$
\sigma_z = \frac{c}{2 \cdot B \cdot 10^{SNR_{dB}/20}}
$$

где $SNR_{dB}$ — SNR в децибелах.

**Пример:** при $c = 1500$ м/с, $B = 100$ кГц, $SNR = 20$ дБ ($SNR_{linear} = 100$):
$$
\sigma_z = \frac{1500}{2 \times 100 \times 10^3 \times 10} = 0.00075 \text{ м} = 0.75 \text{ мм}
$$

**Время задержки (TOF):**

$$
\tau = \frac{2z}{c}
$$

где:
- $\tau$ — время задержки (time of flight), с
- $z$ — глубина интерфейса в профиле, м
- $c$ — скорость звука в среде, м/с

**Глубина интерфейса из TOF:**

$$
z = \frac{c \cdot \tau}{2}
$$

**Примечание:** В контексте SBP "дальность" обычно означает глубину проникновения в грунт (вертикальное расстояние), а не горизонтальную дальность до цели.

### 2.9. Временная модель отражений (детализация)

#### 2.9.1. Формирование принимаемого сигнала для профиля

Для получения профиля грунта принимаемый сигнал формируется как сумма всех отражений:

$$
s_{rx}(t) = \sum_{i=1}^{N} R_i \cdot s_{tx}\left(t - \tau_i\right) \cdot A_i(t)
$$

где:
- $N$ — количество интерфейсов в профиле
- $\tau_i = \frac{2\sum_{j=0}^{i-1} z_j}{c_j}$ — время задержки до $i$-го интерфейса
- $z_j$ — толщина $j$-го слоя
- $A_i(t)$ — затухание амплитуды для $i$-го отражения:

$$
A_i(t) = \exp\left(-2\sum_{j=1}^{i-1} \alpha_j z_j\right) \cdot \exp\left(-\alpha_i \cdot c_i \cdot (t - \tau_i)\right)
$$

#### 2.9.2. Многократные отражения в профиле

Для учёта многократных отражений (например, отражение от дна, затем отражение от дна–поверхности, и т.д.):

$$
s_{rx}^{multiple}(t) = \sum_{k=1}^{K} \sum_{i=1}^{N} R_i^k \cdot s_{tx}\left(t - k\tau_i\right) \cdot A_i^k(t)
$$

где $k$ — порядок отражения, $K$ — максимальный порядок (обычно $K=3$–$5$).

#### 2.9.3. Динамический диапазон профиля

Отношение амплитуд донного и глубокого отражений определяет требуемый динамический диапазон:

$$
DR = 20\log_{10}\left(\frac{A_{bottom}}{A_{deep}}\right) = 2\alpha \Delta z + 20\log_{10}\left(\frac{R_{bottom}}{R_{deep}}\right)
$$

Типично: $DR = 40$–$80$ дБ для профиля на глубину 10–50 м.

---

## 3. АРХИТЕКТУРА СИСТЕМЫ

### 3.1. Модульная структура

Система состоит из трёх основных модулей:

```
┌──────────────────────────┐
│           GUI            │
│  Ввод и выбор параметров │
│  Визуализация результатов│
└────────────▲─────────────┘
             │ DTO
┌────────────┴─────────────┐
│           CORE           │
│  Симуляция и оптимизация │
│  Физические модели       │
└────────────▲─────────────┘
             │ API
┌────────────┴─────────────┐
│           DATA           │
│  База параметров         │
│  Трансдьюсеры, LNA, VGA, ADC │
└──────────────────────────┘
```

### 3.2. Модуль CORE (Вычислительное ядро)

#### 3.2.1. Назначение

- Моделирование гидроакустического канала
- Моделирование передающего и приёмного трактов
- Генерация и обработка CHIRP-сигнала
- Расчёт глубины интерфейсов в профиле и точности определения глубины
- Итеративная оптимизация параметров

#### 3.2.2. Подсистемы

**WaterModel** — модель воды
- Вычисление скорости звука $c(T, S, P)$
- Расчёт коэффициента поглощения $\alpha(f, T, S, P)$
- Расчёт потерь передачи $TL_{water}(D, f)$

**TransducerModel** — модель трансдьюсера
- Частотные характеристики
- Чувствительность TX: $S_{TX}(f)$, дБ re 1 µPa/V @ 1 м
- Чувствительность RX: $S_{RX}(f)$, дБ re 1 V/µPa
- Диаграмма направленности $DI(\theta, f)$
- Эквивалентная схема (Butterworth–Van Dyke)

**SignalModel** — модель сигнала
- Генерация CHIRP: $f_{start}$, $f_{end}$, $T_p$, оконная функция
- Расчёт полосы частот $B = |f_{end} - f_{start}|$
- Мгновенная частота $f_i(t) = f_0 + \frac{B}{T}t$

**ChannelModel** — модель канала
- Моделирование затухания и потерь распространения $TL(D, f)$
- Применение задержки распространения (TOF)
- Многослойная модель грунта

**ReceiverModel** — модель приёмного тракта
- LNA (Low Noise Amplifier)
- VGA (Variable Gain Amplifier) с TVG
- ADC (Analog-to-Digital Converter)
- Расчёт SNR и клиппинга

**DSPModel** — цифровая обработка сигнала
- Полосовая фильтрация
- Согласованная фильтрация (Matched Filter)
- Вычисление огибающей (Hilbert Transform)
- Определение времени задержки (TOF)

**RangeEstimator** — оценка глубины в профиле
- Расчёт глубины интерфейсов $z_i$ по TOF
- Расчёт $\sigma_z$ (стандартное отклонение глубины)
- Учёт скорости звука $c(T, S, P)$ в воде и грунте

**Optimizer** — оптимизатор параметров
- Анализ результатов симуляции
- Генерация рекомендаций по изменению параметров
- Стратегии оптимизации:
  - Стратегия 1: Максимизация $T_p$ + минимизация усиления VGA
  - Стратегия 2: Минимизация $T_p$ для достижения целевого SNR

**ENOBCalculator** — расчёт эффективной разрядности
- Расчёт ENOB (Effective Number Of Bits)
- Учёт шумов LNA, VGA, ADC
- Анализ совместимости компонентов

#### 3.2.3. Требования к CORE

- Детерминированность вычислений
- Возможность batch-симуляций
- Логирование всех входных и выходных данных
- Unit-тестируемость всех компонентов
- Обработка ошибок при несовместимых входных данных

### 3.3. Модуль DATA (База данных компонентов)

#### 3.3.1. Назначение

- Централизованное хранение справочных данных
- Предоставление API для CORE и GUI
- Неизменяемость данных во время симуляции

#### 3.3.2. Структура данных

**Трансдьюсеры** (`data/transducers/*.json`)

```json
{
  "model": "Model name",
  "f_min": 150000,
  "f_max": 250000,
  "f_0": 200000,
  "B_tr": 100000,
  "S_TX": 180,
  "S_RX": -193,
  "Theta_BW": 15,
  "Q": 5,
  "T_rd": 10,
  "Z": 50,
  "V_max": 100,
  "V_nominal": 50
}
```

Параметры:
- $f_{min}, f_{max}$ — минимальная и максимальная рабочая частота, Гц
- $f_0$ — резонансная частота, Гц
- $B_{tr}$ — полоса пропускания, Гц
- $S_{TX}$ — чувствительность передатчика, дБ re 1 µPa/V @ 1 м
- $S_{RX}$ — чувствительность приёмника, дБ re 1 V/µPa
- $\Theta_{BW}$ — ширина диаграммы направленности, градусы
- $Q$ — добротность
- $T_{rd}$ — время затухания (ring-down), мкс
- $Z$ — импеданс, Ом
- $V_{max}$ — максимальное напряжение, В
- $V_{nominal}$ — номинальное напряжение, В

**LNA** (Low Noise Amplifier) (`data/lna/*.json`)

```json
{
  "G_LNA": 20,
  "NF_LNA": 2,
  "BW_LNA": 1000000,
  "Z_in": 50,
  "V_max": 1.0
}
```

Параметры:
- $G_{LNA}$ — усиление, дБ
- $NF_{LNA}$ — шумовая фигура, дБ
- $BW_{LNA}$ — полоса пропускания, Гц
- $Z_{in}$ — входной импеданс, Ом
- $V_{max}$ — максимальное входное напряжение, В

Модель шума LNA:

Мощность шума LNA (в пересчёте на вход):

$$
N_{LNA} = k_B \cdot T \cdot B \cdot (10^{NF_{LNA}/10} - 1)
$$

где:
- $k_B = 1.38 \times 10^{-23}$ Дж/К — постоянная Больцмана
- $T$ — температура, К (обычно 290 К)
- $B$ — полоса частот, Гц
- $NF_{LNA}$ — шумовая фигура LNA, дБ

В децибелах (мощность шума):

$$
N_{LNA,dBm} = 10 \cdot \log_{10}(k_B \cdot T \cdot B \cdot 1000) + NF_{LNA}
$$

**Требование:** $G_{LNA} \geq 20$–$30$ дБ для подавления шума последующих каскадов (VGA и ADC).

**Правило Friis:** для каскадного соединения усилителей, первый каскад (LNA) должен доминировать в шуме системы.

**VGA** (Variable Gain Amplifier) (`data/vga/*.json`)

```json
{
  "G_min": 0,
  "G_max": 60,
  "delta_G": 1,
  "BW_VGA": 1000000,
  "T_set": 1e-6
}
```

Параметры:
- $G_{min}, G_{max}$ — минимальное и максимальное усиление, дБ
- $\Delta G$ — шаг изменения усиления, дБ
- $BW_{VGA}$ — полоса пропускания, Гц
- $T_{set}$ — время установления, с

Диапазон усиления VGA: $G_{VGA,max} - G_{VGA,min} \geq 60$–$80$ дБ

Закон управления VGA (TVG):

$$
G_{VGA}(t) = G_0 + 20\log_{10}(t) + 2\alpha z(t)
$$

**ADC** (Analog-to-Digital Converter) (`data/adc/*.json`)

```json
{
  "N": 16,
  "f_s": 2000000,
  "V_FS": 2.0,
  "ENOB": 15,
  "SNR": 92
}
```

Параметры:
- $N$ — разрядность, бит
- $f_s$ — частота дискретизации, Гц
- $V_{FS}$ — полный диапазон напряжения, В
- $ENOB$ — эффективная разрядность, бит
- $SNR$ — отношение сигнал/шум ADC, дБ

Динамический диапазон ADC:

$$
DR_{ADC} = 20 \cdot \log_{10}(2^N) = 20 \cdot N \cdot \log_{10}(2) \approx 6.02 \cdot N + 1.76 \text{ дБ}
$$

где $N$ — разрядность ADC, бит.

**Квантовый шум:**

Шаг квантования:

$$
\Delta = \frac{V_{FS}}{2^N}
$$

где:
- $\Delta$ — шаг квантования, В
- $V_{FS}$ — полный диапазон напряжения, В
- $N$ — разрядность, бит

Мощность квантового шума:

$$
P_{quant} = \frac{\Delta^2}{12} = \frac{V_{FS}^2}{12 \cdot 2^{2N}}
$$

SNR квантования:

$$
SNR_{quant} = 10 \cdot \log_{10}\left(\frac{V_{FS}^2/8}{V_{FS}^2/(12 \cdot 2^{2N})}\right) = 10 \cdot \log_{10}\left(\frac{3 \cdot 2^{2N}}{2}\right) \approx 6.02 \cdot N + 1.76 \text{ дБ}
$$

где $V_{FS}^2/8$ — мощность синусоидального сигнала полного диапазона.

**Требование:** $SNR_{quant} \gg SNR_{noise}$ (квантовый шум не должен ограничивать систему)

**ENOB (Effective Number Of Bits):**

$$
ENOB = \frac{SNR_{measured} - 1.76}{6.02}
$$

где $SNR_{measured}$ — измеренный SNR ADC, дБ.

Минимально допустимо: 16 бит
Рекомендуется: 18 бит при $ENOB \geq 16$

#### 3.3.3. Формат хранения

- JSON формат для всех данных
- Версионирование через `metadata.json`
- Структура каталогов:
  - `transducers/` — трансдьюсеры
  - `lna/` — усилители LNA
  - `vga/` — усилители VGA
  - `adc/` — АЦП

### 3.4. Модуль GUI (Пользовательский интерфейс)

#### 3.4.1. Назначение

- Выбор моделей из DATA
- Ввод параметров среды, CHIRP, диапазона глубин
- Запуск симуляции и оптимизации
- Визуализация результатов
- Итеративная коррекция входных данных

#### 3.4.2. Функции

**Ввод параметров:**
- Выбор трансдьюсера, LNA, VGA, ADC
- Параметры среды: $T$ (°C), $S$ (PSU), $z$ (м)
- Параметры CHIRP: $f_{start}$, $f_{end}$, $T_p$, окно
- Диапазон глубин проникновения: $z_{min}$, $z_{max}$, $z_{target}$ (глубина в грунте, м)
- Целевой SNR: $SNR_{target}$ (дБ)
- Стратегия оптимизации

**Визуализация:**
- Графики сигналов на разных стадиях:
  - Переданный сигнал (TX)
  - Сигнал на дне (после прохождения воды)
  - Принятый сигнал (RX)
  - Сигнал после LNA
  - Сигнал после VGA
- График SNR vs. глубина в профиле
- График $\sigma_z$ vs. глубина (точность определения глубины интерфейсов)
- Спектр сигнала
- Результаты оптимизации
- Профиль грунта (A-scan, B-scan)

**Отображение результатов:**
- Профиль грунта: глубины интерфейсов $z_i$, м
- Глубина проникновения $z_{max}$, м
- Вертикальное разрешение $\Delta z$, м
- Точность определения глубины интерфейсов $\sigma_z$, м
- SNR на выходе ADC
- Флаги клиппинга
- Рекомендации оптимизатора
- Информация об уровне сигнала на каждом каскаде

**Экспорт данных:**
- CSV (таблицы результатов)
- JSON (полные данные симуляции)
- PDF (отчёты)

---

## 4. МОДЕЛЬ ПРОФИЛЯ ГРУНТА В СИМУЛЯТОРЕ

### 4.1. Цель моделирования профиля

Основная задача SBP — получение профиля грунта (sub-bottom profile), показывающего:
- Глубину залегания дна
- Количество слоёв под дном
- Толщину каждого слоя
- Характер границ между слоями (резкие/плавные)
- Глубину проникновения сигнала

### 4.2. Входные параметры профиля

Для моделирования профиля требуется задать:
- Количество слоёв $N$
- Для каждого слоя $i$:
  - Толщина слоя $z_i$, м
  - Плотность $\rho_i$, кг/м³
  - Скорость звука $c_i$, м/с
  - Коэффициент затухания $\alpha_i$, дБ/м
  - Коэффициент отражения от нижней границы $R_i$, дБ

### 4.3. Алгоритм построения профиля

1. **Расчёт временных задержек:**
   $$
   \tau_i = \frac{2\sum_{j=0}^{i-1} z_j}{c_j}, \quad i = 1, 2, \ldots, N
   $$
   где $\tau_0 = 0$ (момент отражения от дна).

2. **Расчёт амплитуд отражений:**
   $$
   A_i = A_0 \cdot |R_i| \cdot \exp\left(-2\sum_{j=1}^{i-1} \alpha_j z_j\right)
   $$

3. **Формирование сигнала:**
   $$
   s_{profile}(t) = \sum_{i=1}^{N} A_i \cdot s_{tx}(t - \tau_i)
   $$

4. **Применение TVG:**
   $$
   s_{profile,TVG}(t) = s_{profile}(t) \cdot 10^{G(t)/20}
   $$

5. **Обработка (согласованная фильтрация):**
   $$
   y(t) = s_{profile,TVG}(t) * s_{tx}^*(-t)
   $$

6. **Построение огибающей:**
   $$
   e(t) = |y(t) + j \cdot \mathcal{H}\{y(t)\}|
   $$

7. **Преобразование времени в глубину:**
   $$
   z(t) = \frac{c_{sediment} \cdot t}{2}
   $$
   где $c_{sediment}$ — средняя скорость звука в грунте.

### 4.4. Визуализация профиля

Профиль отображается как:
- **Одномерный профиль:** амплитуда (цвет/яркость) vs. глубина
- **Двумерный профиль (сечение):** амплитуда vs. глубина vs. расстояние (для движущегося судна)

Формат представления:
- **A-scan:** график амплитуды от времени/глубины
- **B-scan:** двумерное изображение (глубина × расстояние) с цветовым кодированием амплитуды

### 4.5. Интерпретация результатов профиля

Симулятор должен предоставлять:
- Временные задержки каждого интерфейса
- Глубины залегания каждого интерфейса
- Амплитуды отражений от каждого интерфейса
- Информацию о наблюдаемости каждого слоя (виден/не виден)
- Причину ненаблюдаемости (низкий SNR, недостаточное разрешение, и т.д.)

### 4.6. Критерии качества профиля

- **Глубина проникновения:** максимальная глубина, на которой слои ещё различимы
- **Вертикальное разрешение:** минимальная толщина различимого слоя
- **Контрастность:** различие амплитуд соседних отражений
- **Соотношение сигнал/шум:** для каждого интерфейса

---

## 5. МОДЕЛЬ ПРИЁМНОГО ТРАКТА

### 4.1. Структура тракта

Рекомендуемая структура:

```
Трансдьюсер → LNA (фиксированный) → Аналоговый Band-pass → VGA (управляемый/TVG) → ADC → Цифровая обработка
```

### 5.2. Модель уровней сигнала

Амплитуда принимаемого сигнала как функция времени:

$$
A(t) = A_0 \cdot r^{-2} \cdot e^{-2\alpha z(t)} \cdot |R(z)|
$$

где $z(t) = \frac{ct}{2}$.

После первого донного отражения:

$$
A(t > t_{bottom}) \ll A(t_{bottom})
$$

### 5.3. Необходимость TVG (Time Variant Gain)

TVG должна компенсировать:
- Сферическое расхождение ($r^{-2}$)
- Затухание в грунте
- Частично — ослабление коэффициента отражения

Общая форма:

$$
G(t) = G_0 + 20\log_{10}(t) + 2\alpha z(t)
$$

Условие наблюдаемости поддонных слоёв:

$$
SNR_{ADC}(t) \geq SNR_{min} \quad \text{при} \quad t > t_{bottom}
$$

Без TVG: $SNR_{ADC}(t_{deep}) \ll 0$ дБ

### 5.4. Условие отсутствия насыщения

$$
A_{ADC,max} < A_{FS}
$$

где $A_{FS}$ — полный диапазон ADC.

### 5.5. Совместная модель шума системы

Общий эквивалентный шум на входе системы (в пересчёте на вход LNA):

$$
N_{sys} = N_{LNA} + \frac{N_{VGA}}{G_{LNA,linear}} + \frac{N_{ADC}}{G_{LNA,linear} \cdot G_{VGA,linear}}
$$

где:
- $N_{LNA}$ — шум LNA, В²/Гц
- $N_{VGA}$ — шум VGA (в пересчёте на вход VGA), В²/Гц
- $N_{ADC}$ — шум ADC (в пересчёте на вход ADC), В²/Гц
- $G_{LNA,linear} = 10^{G_{LNA}/20}$ — усиление LNA в линейном масштабе
- $G_{VGA,linear} = 10^{G_{VGA}/20}$ — усиление VGA в линейном масштабе

**В децибелах:**

$$
N_{sys,dB} = 10 \cdot \log_{10}\left(10^{N_{LNA,dB}/10} + 10^{(N_{VGA,dB} - G_{LNA})/10} + 10^{(N_{ADC,dB} - G_{LNA} - G_{VGA})/10}\right)
$$

**Важно:** для доминирования шума LNA необходимо $G_{LNA} \geq 20$–$30$ дБ.

### 5.6. Сквозная проверка SNR

**SNR на выходе ADC** (до обработки):

$$
SNR_{ADC} = 10 \cdot \log_{10}\left(\frac{P_{signal,ADC}}{P_{noise,ADC}}\right)
$$

где:
- $P_{signal,ADC}$ — мощность сигнала на входе ADC, В²
- $P_{noise,ADC}$ — мощность шума на входе ADC, В²

**SNR после согласованной фильтрации:**

$$
SNR_{out} = SNR_{ADC} + 10 \cdot \log_{10}(B \cdot T)
$$

где $B \cdot T$ — произведение полосы на длительность импульса.

**Условие наблюдаемости:**

$$
SNR_{out}(z_{max}) \geq SNR_{min}
$$

где $SNR_{min}$ — минимальный SNR для уверенного обнаружения (обычно 10–20 дБ).

**Расчёт SNR на каждом каскаде:**

1. **Вход LNA:**
   $$
   SNR_{in} = 10 \cdot \log_{10}\left(\frac{P_{signal,in}}{N_{thermal}}\right)
   $$

2. **Выход LNA:**
   $$
   SNR_{LNA} = SNR_{in} - NF_{LNA}
   $$

3. **Выход VGA:**
   $$
   SNR_{VGA} \approx SNR_{LNA}
   $$
   (усиление VGA не изменяет SNR, так как усиливаются и сигнал, и шум)

4. **Выход ADC:**
   $$
   SNR_{ADC} = -10 \cdot \log_{10}\left(10^{-SNR_{VGA}/10} + 10^{-SNR_{quant}/10}\right)
   $$
   где $SNR_{quant} = 6.02 \cdot N + 1.76$ дБ — SNR квантования для $N$-битного ADC.

---

## 6. ОПТИМИЗАЦИЯ ПАРАМЕТРОВ

### 6.1. Целевая функция

$$
J = w_1 \cdot SNR(z) - w_2 \cdot \Delta z - w_3 \cdot P
$$

где:
- $w_1, w_2, w_3$ — весовые коэффициенты
- $SNR(z)$ — SNR на глубине $z$
- $\Delta z$ — вертикальное разрешение
- $P$ — потребляемая мощность

### 6.2. Ограничения

$$
\begin{cases}
P \leq P_{max} \\
B_{min} \leq B \leq B_{max} \\
T \leq T_{max} \\
A_{ADC}(t) < A_{FS} \\
SNR_{ADC}(t_{max}) \geq SNR_{min} \\
G_{VGA} \in [G_{min}, G_{max}]
\end{cases}
$$

### 6.3. Стратегии оптимизации

#### 6.3.1. Стратегия 1: Максимизация $T_p$ + минимизация $G_{VGA}$

Цель: использовать максимальную длительность импульса для улучшения SNR, затем найти минимальное усиление VGA, достаточное для достижения целевого SNR.

Алгоритм:
1. Вычислить максимальную длительность импульса:
   $$
   T_{p,max} = 0.8 \cdot \frac{2D_{target}}{c}
   $$
2. Установить $T_p = T_{p,max}$
3. Вычислить минимальное $G_{VGA}$, необходимое для достижения $SNR_{target}$
4. Если $G_{VGA} > G_{VGA,max}$, увеличить $T_p$ (агрессивно)

#### 6.3.2. Стратегия 2: Минимизация $T_p$ для достижения $SNR_{target}$

Цель: найти минимальную длительность импульса, достаточную для достижения целевого SNR.

Алгоритм:
1. Вычислить минимальное $T_p$, необходимое для $SNR \geq SNR_{target}$
2. Установить $T_p$ равным найденному значению
3. Вычислить оптимальное $G_{VGA}$

### 6.4. Критерии останова оптимизации

- Все ограничения выполнены
- $SNR_{ADC} \geq SNR_{target}$
- $\sigma_z \leq \sigma_{z,max}$ (типично 1 см) — точность определения глубины интерфейсов
- Отсутствие клиппинга ADC
- Глубина проникновения в допустимых пределах: $z_{min} \leq z_{max} \leq z_{max,required}$
- Все интерфейсы в профиле различимы (SNR достаточен для обнаружения)

### 6.5. Рекомендации оптимизатора

Оптимизатор генерирует рекомендации:
- Увеличение/уменьшение $T_p$
- Изменение $f_{start}$, $f_{end}$
- Изменение усиления VGA
- Смена компонентов (трансдьюсер, LNA, VGA, ADC)

---

## 7. МОДЕЛЬ ТРАНСДЬЮСЕРА

### 7.1. Эквивалентная электрическая модель

Модель Butterworth–Van Dyke:

$$
Z(f) = R_m + j\omega L_m + \frac{1}{j\omega C_m} \parallel C_0
$$

где:
- $R_m, L_m, C_m$ — мотиональные параметры
- $C_0$ — паразитная ёмкость

### 7.2. Электроакустическое преобразование

Связь электрического сигнала и акустического давления:

$$
p(f, r) = \frac{S(f) \cdot V(f)}{r}
$$

где:
- $S(f)$ — чувствительность трансдьюсера, Па/В
- $V(f)$ — напряжение возбуждения, В
- $r$ — расстояние, м

### 7.3. Source Level

$$
SL = 170 + 10\log_{10}(P_{ac}) + DI
$$

где:
- $P_{ac}$ — акустическая мощность, Вт
- $DI$ — индекс направленности, дБ (0–10 дБ)

При КПД трансдьюсера $\eta$:

$$
P_{ac} = \eta \cdot P_{elec}
$$

Типично: $\eta = 0.3$–$0.6$

Ожидаемый Source Level: $SL \approx 210$–$220$ дБ re 1 µPa @ 1 м

### 7.4. Ограничение по кавитации

Условие отсутствия кавитации:

$$
p_{max} < p_{hydro} + p_{atm} - p_{vap}
$$

Упрощённо:

$$
p_{max} \lesssim 100\text{–}150 \text{ кПа}
$$

Симулятор обязан:
- Рассчитывать давление у апертуры
- Показывать зоны кавитации
- Ограничивать допустимую мощность

---

## 8. МОДЕЛЬ ПЕРЕДАЮЩЕГО ТРАКТА

### 8.1. Структура передающего тракта

```
Генератор CHIRP → Усилитель мощности → Трансдьюсер (TX)
```

### 8.2. Модель драйвера излучателя

Параметры:
- Максимальное напряжение $V_{max}$, В
- Выходной импеданс $Z_{out}$, Ом
- Slew rate (скорость нарастания), В/с
- Гармонические искажения (THD), %

Ограничение:

$$
V_{tx}(t) \leq V_{max}
$$

### 8.3. Расчёт Source Level

Акустическая мощность:

$$
P_{ac} = \eta \cdot P_{elec} = \eta \cdot \frac{V_{tx}^2}{Z_{tx}}
$$

где $\eta$ — КПД трансдьюсера (0.3–0.6).

Source Level:

$$
SL = 170 + 10\log_{10}(P_{ac}) + DI
$$

где:
- $P_{ac}$ — акустическая мощность, Вт
- $DI$ — индекс направленности, дБ (0–10 дБ)

Типичные значения: $SL \approx 210$–$220$ дБ re 1 µPa @ 1 м

### 8.4. Ограничение по кавитации

Условие отсутствия кавитации:

$$
p_{max} < p_{hydro} + p_{atm} - p_{vap}
$$

где:
- $p_{hydro} = \rho g z$ — гидростатическое давление
- $p_{atm} \approx 101.3$ кПа — атмосферное давление
- $p_{vap} \approx 2.3$ кПа — давление паров воды

Упрощённо:

$$
p_{max} \lesssim 100\text{–}150 \text{ кПа}
$$

Симулятор должен:
- Рассчитывать давление у апертуры трансдьюсера
- Показывать зоны кавитации
- Ограничивать допустимую мощность передатчика

### 8.5. Связь средней мощности и Source Level

При работе с длительными CHIRP-сигналами используется средняя мощность:

$$
P_{ac,avg} = \eta \cdot P_{avg}
$$

Эквивалентный Source Level:

$$
SL_{eq} = 170 + 10\log_{10}(P_{ac,avg}) + DI
$$

Типично: $SL_{eq} \approx 225$–$230$ дБ re 1 µPa @ 1 м

---

## 9. ВЕРИФИКАЦИЯ МОДЕЛИ

### 9.1. Сравнение с аналитикой

Отклонение не должно превышать:

$$
\left|\frac{z_{model} - z_{analytical}}{z_{analytical}}\right| \leq 10\%
$$

### 9.2. Критерий корректности модели

Симуляция должна:
- Объяснять реальные SBP-профили
- Корректно предсказывать «пропадание» слоёв
- Совпадать с натурными данными ±10–15%

### 9.3. Эффект насыщения

Симулятор должен демонстрировать:

$$
\frac{dz_{max}}{dP_{avg}} \to 0 \quad \text{при} \quad P_{avg} > 500\text{–}800 \text{ Вт}
$$

То есть: рост мощности ≠ пропорциональный рост глубины. Ограничение задаёт затухание грунта, а не $SL$.

---

## 10. ВЫХОДНЫЕ ДАННЫЕ СИМУЛЯТОРА

### 10.1. Основные результаты

- Профиль грунта: глубины интерфейсов $z_i$, м
- Глубина проникновения: $z_{max}$, м
- Вертикальное разрешение: $\Delta z$, м (минимальная толщина различимого слоя)
- Точность определения глубины интерфейсов: $\sigma_z$, м
- SNR на выходе ADC: $SNR_{ADC}$, дБ
- Флаги клиппинга: наличие/отсутствие насыщения

### 10.2. Уровни сигналов по каскадам

- Уровень сигнала на каждом этапе (дБВ, µВ)
- SNR на каждом этапе
- Запас по насыщению
- Требуемая разрядность ADC
- Оптимальные параметры TVG

### 10.3. Сигналы для визуализации

- Переданный сигнал (TX)
- Сигнал на дне (после прохождения воды вперёд)
- Принятый сигнал (после прохождения воды назад)
- Сигнал после LNA
- Сигнал после VGA
- Временная ось для всех сигналов

### 10.4. Рекомендации оптимизатора

- Предлагаемые изменения параметров
- Текущие и рекомендуемые значения
- Обоснование рекомендаций
- Информация о совместимости компонентов

---

## 11. ГЛУБИНА ПРОНИКНОВЕНИЯ: ЭФФЕКТ НАСЫЩЕНИЯ

### 11.1. Зависимость глубины от мощности

Симулятор должен демонстрировать эффект насыщения:

$$
\frac{dz_{max}}{dP_{avg}} \to 0 \quad \text{при} \quad P_{avg} > 500\text{–}800 \text{ Вт}
$$

То есть: **рост мощности ≠ пропорциональный рост глубины**.

### 11.2. Ограничивающие факторы

При больших мощностях глубина проникновения ограничивается:
- **Затуханием в грунте** (доминирующий фактор), а не Source Level
- Кавитацией (предел мощности передатчика)
- Нелинейными эффектами в воде и грунте

### 11.3. Оптимальная мощность

Существует оптимальная мощность, при которой дальнейшее увеличение не даёт значимого выигрыша в глубине проникновения.

---

## 12. КЛЮЧЕВЫЕ ИНЖЕНЕРНЫЕ ВЫВОДЫ

### 12.1. Для приёмного тракта

**Поддонные отражения в SBP принципиально ненаблюдаемы без компенсации динамического диапазона до ADC.**

TVG является обязательной частью приёмного тракта, а разрядность ADC оптимизируется совместно с LNA и VGA.

### 12.2. Для полной системы

**Sub-Bottom Profiler является сильно нестационарной системой с динамическим диапазоном, превышающим возможности ADC.**

Только совместная оптимизация трансдьюсера, аналогового TVG и ADC обеспечивает наблюдаемость поддонных отражений.

### 12.3. Ограничения системы

- Динамический диапазон принимаемого сигнала: 80–120 дБ
- Превышает линейные возможности ADC без управляемого усиления
- Требует TVG с диапазоном 60–80 дБ
- Минимальная разрядность ADC: 16 бит (рекомендуется 18 бит)

---

## 13. БИБЛИОТЕКА КОМПОНЕНТОВ

### 13.1. Трансдьюсеры

Симулятор должен поддерживать библиотеку реальных трансдьюсеров с параметрами:
- Частотный диапазон ($f_{min}$, $f_{max}$)
- Чувствительность TX/RX ($S_{TX}$, $S_{RX}$)
- Полоса пропускания ($B_{tr}$)
- Диаграмма направленности ($DI$, $\Theta_{BW}$)
- Максимальное напряжение ($V_{max}$)

Формат хранения: JSON файлы в `data/transducers/`

### 13.2. Усилители LNA

Библиотека реальных микросхем (ADI, TI, Maxim):
- Усиление ($G_{LNA}$)
- Шумовая фигура ($NF_{LNA}$)
- Полоса пропускания ($BW_{LNA}$)
- Входной импеданс ($Z_{in}$)

Формат хранения: JSON файлы в `data/lna/`

### 13.3. Усилители VGA

Библиотека микросхем VGA с TVG:
- Диапазон усиления ($G_{min}$, $G_{max}$)
- Шаг изменения ($\Delta G$)
- Полоса пропускания ($BW_{VGA}$)
- Время установления ($T_{set}$)

Формат хранения: JSON файлы в `data/vga/`

### 13.4. АЦП (ADC)

Библиотека реальных АЦП:
- Разрядность ($N$)
- Частота дискретизации ($f_s$)
- Полный диапазон ($V_{FS}$)
- ENOB (эффективная разрядность)
- SNR (отношение сигнал/шум)

Формат хранения: JSON файлы в `data/adc/`

### 13.5. Пользовательское добавление моделей

Симулятор должен позволять:
- Добавлять новые компоненты через JSON файлы
- Редактировать существующие параметры
- Версионировать базу данных компонентов

---

## 14. ОЖИДАЕМЫЕ РЕЗУЛЬТАТЫ

Разрабатываемый программный комплекс предоставит:

1. **Численную модель SBP**
   - Полная модель гидроакустического канала
   - Модель приёмного тракта с реальными компонентами
   - Модель обработки сигнала

2. **Инструмент прогнозирования глубины проникновения**
   - Расчёт максимальной глубины для заданных параметров
   - Анализ влияния параметров на глубину

3. **Оптимизатор параметров**
   - Автоматический подбор оптимальных параметров
   - Две стратегии оптимизации
   - Рекомендации по изменению параметров

4. **Методическую базу для инженерных расчётов**
   - Документированные формулы и модели
   - База данных реальных компонентов
   - Верифицированные алгоритмы

---

## 15. ТРЕБОВАНИЯ К СИМУЛЯТОРУ ПРИЁМНОГО ТРАКТА

Симулятор должен:

1. **Моделировать аналоговый TVG:**
   - Функцию $G(t)$ с параметрами $G_0$, $n$, $\beta$
   - Дискретное управление VGA с шагом $\Delta G$
   - Время установления $T_{set}$

2. **Учитывать насыщение:**
   - Насыщение VGA (если сигнал превышает максимальный уровень)
   - Насыщение ADC (квантование с ограничением)
   - Клиппинг сигнала

3. **Учитывать квантование:**
   - Модель квантования с шагом $\Delta = V_{FS}/2^N$
   - Квантовый шум: $\sigma_{quant} = \Delta/\sqrt{12}$

4. **Моделировать шум каждого каскада:**
   - Тепловой шум LNA: $N_{LNA} = k_B T B (10^{NF/10} - 1)$
   - Шум VGA (усиление шума LNA)
   - Шум ADC (квантовый + аналоговый)

5. **Оценивать SNR после корреляции:**
   $$
   SNR_{out} = SNR_{ADC} + 10\log_{10}(BT)
   $$

---

## 16. СОВМЕСТНАЯ ОПТИМИЗАЦИЯ LNA–VGA–ADC

### 16.1. Целевая функция оптимизации

$$
J = w_1 \cdot SNR_{deep} - w_2 \cdot P - w_3 \cdot DR_{unused}
$$

где:
- $SNR_{deep}$ — SNR на максимальной глубине
- $P$ — потребляемая мощность
- $DR_{unused}$ — неиспользованный динамический диапазон

### 16.2. Ограничения

$$
\begin{cases}
A_{ADC}(t) < A_{FS} \\
SNR_{ADC}(t_{max}) \geq SNR_{min} \\
G_{VGA} \in [G_{min}, G_{max}]
\end{cases}
$$

### 16.3. Переменные оптимизации

- Модель трансдьюсера
- Модель LNA
- Модель VGA
- Модель ADC
- Закон TVG ($G(t)$)
- Параметры CHIRP ($f_{start}$, $f_{end}$, $T_p$)

### 16.4. Ограничения по доступности компонентов

Оптимизатор должен учитывать:
- Реальную доступность компонентов на рынке
- Стоимость компонентов
- Энергопотребление
- Тепловые ограничения

---

## 17. ОБРАБОТКА СИГНАЛА И DSP

### 17.1. Полосовая фильтрация

$$
x_f(t) = x(t) * h_{BP}(t)
$$

где $h_{BP}(t)$ — импульсная характеристика полосового фильтра с полосой $[f_{start}, f_{end}]$.

### 17.2. Согласованная фильтрация (Matched Filter)

$$
y(t) = x_f(t) * s_{tx}^*(-t)
$$

Процессинговый выигрыш:

$$
PG = 10\log_{10}(BT)
$$

### 17.3. Огибающая (Envelope Detection)

$$
e(t) = |x(t) + j \cdot \mathcal{H}\{x(t)\}|
$$

где $\mathcal{H}\{\cdot\}$ — преобразование Гильберта.

### 17.4. Компенсация потерь (TVG)

Цифровая TVG (после ADC):

$$
y_{TVG}(t) = y(t) \cdot 10^{G_{TVG}(t)/20}
$$

где $G_{TVG}(t)$ — функция временной регулировки усиления.

### 17.5. Определение времени задержки (TOF)

Время задержки определяется как:

$$
\tau = \arg\max_t |y(t)|
$$

Глубина интерфейса:

$$
z = \frac{c \cdot \tau}{2}
$$

где $z$ — глубина интерфейса в профиле, м.

### 17.6. Точность определения глубины в профиле

Стандартное отклонение оценки глубины интерфейса:

$$
\sigma_z = \frac{c}{2 \cdot B \cdot \sqrt{SNR}}
$$

где:
- $\sigma_z$ — стандартное отклонение глубины, м
- $c$ — скорость звука в среде, м/с
- $B$ — полоса частот, Гц
- $SNR$ — отношение сигнал/шум (линейное)

---

## 18. ОЦЕНКА ГЛУБИНЫ ПРОНИКНОВЕНИЯ

### 18.1. Акустическое уравнение для профиля

$$
SNR(z) = SL - TL_{water}(z) - TL_{sediment}(z) + R - NL + PG
$$

### 18.2. Максимальная глубина проникновения

$$
z_{max} = \frac{SL - TL_{water} + R - NL + PG - SNR_{min}}{2\alpha}
$$

### 18.3. Критерий обнаружения

$$
SNR(z) \geq SNR_{min}
$$

Типично: $SNR_{min} = 10$–$20$ дБ для уверенного обнаружения слоя.

### 18.4. Вертикальное разрешение

$$
\Delta z = \frac{c}{2B}
$$

Пример: при $B = 100$ кГц, $c = 1500$ м/с:
$$
\Delta z = 7.5 \text{ мм}
$$

---

## 19. ВЕРТИКАЛЬНОЕ РАЗРЕШЕНИЕ

Вертикальное разрешение определяет минимальную толщину различимого слоя:

$$
\Delta z = \frac{c}{2B}
$$

где:
- $c$ — скорость звука в среде, м/с
- $B$ — полоса частот CHIRP-сигнала, Гц

Связь с длительностью импульса:
- Чем больше $B$, тем лучше разрешение
- Чем больше $T_p$, тем больше энергия, но разрешение не улучшается

Торговый компромисс:
- Большая полоса $B$ → лучше разрешение, но больше затухание
- Малая полоса $B$ → меньше затухание, но хуже разрешение

---

## 20. ШУМ И ПОМЕХИ

### 20.1. Аддитивный шум

$$
s_{noise}(t) \sim \mathcal{N}(0, \sigma^2)
$$

### 20.2. Тепловой шум

Мощность теплового шума:

$$
N_{thermal} = k_B T B F
$$

где:
- $k_B = 1.38 \times 10^{-23}$ Дж/К — постоянная Больцмана
- $T$ — температура, К (обычно 290 К)
- $B$ — полоса частот, Гц
- $F$ — шумовая фигура системы

### 20.3. Шум океана

Уровень шума океана (ambient noise):

$$
NL_{ocean}(f) = 50 + 7.5f^{1/2} + 20\log_{10}(f) - 17\log_{10}(f + 0.03)
$$

где $f$ — частота, кГц.

### 20.4. Отношение сигнал/шум

$$
SNR = 10\log_{10}\left(\frac{P_{signal}}{P_{noise}}\right)
$$

---

## 21. МНОГОСЛОЙНАЯ МОДЕЛЬ ГРУНТА (ДЕТАЛИЗАЦИЯ)

### 21.1. Структура слоёв

Модель представляет грунт как последовательность слоёв:

```
Вода (z=0)
    ↓ Интерфейс 1 (z=z1)
Слой 1 (толщина z1, параметры: ρ1, c1, α1)
    ↓ Интерфейс 2 (z=z1+z2)
Слой 2 (толщина z2, параметры: ρ2, c2, α2)
    ↓ Интерфейс 3 (z=z1+z2+z3)
Слой 3 (толщина z3, параметры: ρ3, c3, α3)
    ...
```

### 21.2. Расчёт импедансов

Для каждого слоя:

$$
Z_i = \rho_i \cdot c_i
$$

### 21.3. Расчёт коэффициентов отражения

На каждом интерфейсе:

$$
R_i = \frac{Z_{i+1} - Z_i}{Z_{i+1} + Z_i}
$$

### 21.4. Расчёт временных задержек

Время задержки до $i$-го интерфейса:

$$
\tau_i = \frac{2\sum_{j=1}^{i-1} z_j}{c_j} + \frac{2z_i}{2c_i}
$$

(упрощённо: $\tau_i = \frac{2\sum_{j=1}^{i} z_j}{c_j}$ при $c_j \approx c_i$)

### 21.5. Формирование полного сигнала

$$
s_{rx}(t) = \sum_{i=1}^{N} R_i \cdot s_{tx}(t - \tau_i) \cdot \exp\left(-2\sum_{j=1}^{i-1} \alpha_j z_j\right)
$$

---

## 22. ОПТИМИЗАЦИЯ СТРУКТУРЫ ПРИЁМНОГО ТРАКТА

### 22.1. Рекомендуемая структура

```
Трансдьюсер (RX)
    ↓
LNA (фиксированный, G_LNA = 20-30 дБ)
    ↓
Аналоговый Band-pass фильтр
    ↓
VGA (управляемый, TVG, G_VGA = 0-60 дБ)
    ↓
ADC (16-18 бит)
    ↓
Цифровая обработка (DSP)
```

### 22.2. Требования к LNA

- Минимальная шумовая температура
- Фиксированное усиление: $G_{LNA} \geq 20$–$30$ дБ
- Линейный режим работы
- Шумовая фигура: $NF_{LNA} < 3$ дБ (желательно < 2 дБ)

### 22.3. Требования к VGA

- Диапазон усиления: $G_{VGA,max} - G_{VGA,min} \geq 60$–$80$ дБ
- Шаг изменения: $\Delta G = 1$ дБ (желательно)
- Время установления: $T_{set} < 10$ мкс
- Закон управления должен аппроксимировать:
  $$
  G_{VGA}(t) \approx TL_{water}(t) + TL_{sediment}(t)
  $$

### 22.4. Требования к ADC

- Разрядность: $N \geq 16$ бит (рекомендуется 18 бит)
- ENOB: $ENOB \geq 16$ бит
- Частота дискретизации: $f_s \geq 2 \cdot f_{end}$ (критерий Найквиста)
- Динамический диапазон: $DR_{ADC} \approx 6.02N + 1.76$ дБ

### 22.5. Условие отсутствия насыщения

$$
A_{ADC}(t) < A_{FS} \quad \forall t
$$

где $A_{FS} = V_{FS}/2$ — полный диапазон ADC.

---

## ПРИЛОЖЕНИЕ A: ВСПОМОГАТЕЛЬНЫЕ ФОРМУЛЫ ДЛЯ РАЗРАБОТЧИКОВ

### A.1. Преобразование между линейным и децибельным масштабом

**Мощность:**

$$
P_{dB} = 10 \cdot \log_{10}(P_{linear})
$$

$$
P_{linear} = 10^{P_{dB}/10}
$$

**Напряжение/Амплитуда:**

$$
A_{dB} = 20 \cdot \log_{10}(A_{linear})
$$

$$
A_{linear} = 10^{A_{dB}/20}
$$

**Усиление:**

$$
G_{linear} = 10^{G_{dB}/20}
$$

$$
G_{dB} = 20 \cdot \log_{10}(G_{linear})
$$

### A.2. Формулы для ADC

**Квантование сигнала:**

$$
x_{quantized}[n] = \Delta \cdot \text{round}\left(\frac{x[n]}{\Delta}\right)
$$

где $\Delta = V_{FS}/2^N$ — шаг квантования.

**Дискретизация:**

$$
x[n] = x(n \cdot T_s)
$$

где $T_s = 1/f_s$ — период дискретизации, $f_s$ — частота дискретизации.

**Критерий Найквиста:**

$$
f_s \geq 2 \cdot f_{max}
$$

где $f_{max}$ — максимальная частота в сигнале.

### A.3. Формулы для обработки сигналов

**Свёртка (для согласованной фильтрации):**

$$
y[n] = \sum_{k=0}^{M-1} h[k] \cdot x[n-k]
$$

где $h[k]$ — импульсная характеристика фильтра, $x[n]$ — входной сигнал.

**Преобразование Гильберта (для огибающей):**

$$
\mathcal{H}\{x(t)\} = \frac{1}{\pi} \int_{-\infty}^{\infty} \frac{x(\tau)}{t-\tau} d\tau
$$

В дискретном виде:

$$
x_h[n] = \mathcal{H}\{x[n]\} = \sum_{k=-\infty}^{\infty} h[k] \cdot x[n-k]
$$

где $h[k]$ — импульсная характеристика преобразования Гильберта.

**Огибающая:**

$$
e[n] = \sqrt{x^2[n] + x_h^2[n]} = |x[n] + j \cdot x_h[n]|
$$

### A.4. Формулы для расчёта SNR

**SNR из мощностей:**

$$
SNR_{dB} = P_{signal,dB} - P_{noise,dB}
$$

**SNR из напряжений:**

$$
SNR_{dB} = 20 \cdot \log_{10}\left(\frac{V_{signal,rms}}{V_{noise,rms}}\right) = V_{signal,rms,dB} - V_{noise,rms,dB}
$$

где RMS (Root Mean Square) — среднеквадратичное значение.

**SNR для сложения независимых шумов:**

$$
P_{noise,total} = P_{noise,1} + P_{noise,2} + \ldots
$$

В децибелах (приближённо, для двух источников):

$$
P_{noise,total,dB} \approx \max(P_{noise,1,dB}, P_{noise,2,dB}) + 3 \text{ дБ}
$$

(если мощности примерно равны)

### A.5. Формулы для времени задержки (TOF)

**TOF для round-trip:**

$$
\tau = \frac{2 \cdot D}{c}
$$

**Глубина из TOF:**

$$
z = \frac{c_{sediment} \cdot \tau}{2}
$$

где $c_{sediment}$ — скорость звука в грунте.

**Задержка в отсчётах (samples):**

$$
N_{delay} = \tau \cdot f_s = \frac{2 \cdot D \cdot f_s}{c}
$$

---

## ПРИЛОЖЕНИЕ B: ОБОЗНАЧЕНИЯ

| Обозначение | Описание | Единицы |
|-------------|----------|---------|
| $A$ | Амплитуда сигнала | В или Па |
| $B$ | Полоса частот | Гц |
| $c$ | Скорость звука | м/с |
| $D$ | Дальность (горизонтальная) | м |
| $z$ | Глубина (вертикальная, в профиле) | м |
| $z_{max}$ | Максимальная глубина проникновения | м |
| $\Delta z$ | Вертикальное разрешение профиля | м |
| $\sigma_z$ | Точность определения глубины интерфейса | м |
| $f$ | Частота | Гц |
| $G$ | Усиление | дБ |
| $NF$ | Шумовая фигура | дБ |
| $P$ | Мощность | Вт |
| $R$ | Коэффициент отражения | дБ или безразм. |
| $S$ | Солёность | PSU |
| $SL$ | Source Level | дБ re 1 µPa @ 1 м |
| $SNR$ | Отношение сигнал/шум | дБ |
| $T$ | Температура | °C |
| $T_p$ | Длительность импульса | с или мкс |
| $TL$ | Transmission Loss | дБ |
| $\alpha$ | Коэффициент поглощения | дБ/м |
| $\sigma_z$ | Стандартное отклонение глубины интерфейса | м |
| $\rho$ | Плотность | кг/м³ |

---

## ПРИЛОЖЕНИЕ C: СПИСОК ЛИТЕРАТУРЫ

1. Mackenzie, K. V. (1981). Nine-term equation for sound speed in the oceans. *The Journal of the Acoustical Society of America*, 70(3), 807-812.

2. Ainslie, M. A., & McColm, J. G. (1998). A simplified formula for viscous and chemical absorption in sea water. *The Journal of the Acoustical Society of America*, 103(3), 1671-1672.

3. Urick, R. J. (1983). *Principles of Underwater Sound* (3rd ed.). McGraw-Hill.

4. Kinsler, L. E., Frey, A. R., Coppens, A. B., & Sanders, J. V. (2000). *Fundamentals of Acoustics* (4th ed.). John Wiley & Sons.

---
